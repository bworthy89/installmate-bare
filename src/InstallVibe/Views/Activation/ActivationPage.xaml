<Page
    x:Class="InstallVibe.Views.Activation.ActivationPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid Padding="40">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Step Indicator -->
        <StackPanel Grid.Row="0" Margin="0,0,0,24">
            <TextBlock Text="Step 2 of 2"
                       Style="{StaticResource CaptionTextBlockStyle}"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       HorizontalAlignment="Center"/>
            <!-- Progress Bar -->
            <ProgressBar Value="100" Maximum="100" Margin="0,8,0,0"/>
        </StackPanel>

        <!-- Header -->
        <StackPanel Grid.Row="1" Spacing="8" Margin="0,0,0,32">
            <TextBlock Text="Complete Your Installation"
                       Style="{StaticResource TitleTextBlockStyle}"
                       HorizontalAlignment="Center"/>
            <TextBlock Text="Enter your product key to complete setup"
                       Style="{StaticResource BodyTextBlockStyle}"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       HorizontalAlignment="Center"/>
        </StackPanel>

        <!-- Content -->
        <StackPanel Grid.Row="2"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Top"
                    MaxWidth="500"
                    Spacing="24">

            <!-- Not Activated View -->
            <StackPanel Spacing="16" Visibility="{x:Bind ViewModel.IsActivated, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">

                <!-- Product Key Input -->
                <TextBox x:Name="ProductKeyTextBox"
                         Header="License Key"
                         PlaceholderText="XXXXX-XXXXX-XXXXX-XXXXX-XXXXX"
                         Text="{x:Bind ViewModel.ProductKey, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         MaxLength="29"
                         IsEnabled="{x:Bind ViewModel.IsActivating, Mode=OneWay, Converter={StaticResource InverseBoolConverter}}"
                         FontFamily="Consolas"
                         CharacterSpacing="50"/>

                <!-- Error Message -->
                <InfoBar IsOpen="{x:Bind ViewModel.ErrorMessage, Mode=OneWay, Converter={StaticResource NullToBoolConverter}}"
                         Severity="Error"
                         Message="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}"
                         IsClosable="True"/>

                <!-- Complete Setup Button -->
                <Button Command="{x:Bind ViewModel.ActivateCommand}"
                        Style="{StaticResource AccentButtonStyle}"
                        HorizontalAlignment="Stretch"
                        IsEnabled="{x:Bind ViewModel.IsActivating, Mode=OneWay, Converter={StaticResource InverseBoolConverter}}">
                    <Button.Content>
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <ProgressRing IsActive="{x:Bind ViewModel.IsActivating, Mode=OneWay}"
                                          Width="16" Height="16"
                                          Visibility="{x:Bind ViewModel.IsActivating, Mode=OneWay}"/>
                            <TextBlock Text="{x:Bind ViewModel.IsActivating, Mode=OneWay, Converter={StaticResource BoolToTextConverter}, ConverterParameter='Completing Setup...|Complete Setup'}"/>
                        </StackPanel>
                    </Button.Content>
                </Button>

                <!-- Help Text -->
                <StackPanel Spacing="8">
                    <TextBlock Text="License Types:"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               FontWeight="SemiBold"/>
                    <TextBlock Style="{StaticResource CaptionTextBlockStyle}">
                        <Run Text="• Tech License:"/>
                        <Run Text="Read-only access to guides" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    </TextBlock>
                    <TextBlock Style="{StaticResource CaptionTextBlockStyle}">
                        <Run Text="• Admin License:"/>
                        <Run Text="Full access including guide editor" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    </TextBlock>
                </StackPanel>
            </StackPanel>

            <!-- Installation Complete View -->
            <StackPanel Spacing="16" Visibility="{x:Bind ViewModel.IsActivated, Mode=OneWay}">

                <!-- Success Icon -->
                <FontIcon Glyph="&#xE73E;"
                          FontSize="64"
                          Foreground="{ThemeResource SystemFillColorSuccessBrush}"
                          HorizontalAlignment="Center"/>

                <!-- Success Message -->
                <StackPanel Spacing="8">
                    <TextBlock Text="Installation Complete!"
                               Style="{StaticResource TitleTextBlockStyle}"
                               HorizontalAlignment="Center"
                               Foreground="{ThemeResource SystemFillColorSuccessBrush}"/>
                    <TextBlock Text="{x:Bind ViewModel.LicenseInfo, Mode=OneWay}"
                               Style="{StaticResource BodyTextBlockStyle}"
                               HorizontalAlignment="Center"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    <TextBlock Text="Starting InstallVibe..."
                               Style="{StaticResource CaptionTextBlockStyle}"
                               HorizontalAlignment="Center"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Margin="0,8,0,0"/>
                </StackPanel>
            </StackPanel>

        </StackPanel>
    </Grid>
</Page>
