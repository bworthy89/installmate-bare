<UserControl
    x:Class="InstallVibe.Controls.MediaUploadControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <UserControl.Resources>
        <Style x:Key="MediaCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}"/>
            <Setter Property="BorderBrush" Value="{ThemeResource CardStrokeColorDefaultBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>
    </UserControl.Resources>

    <StackPanel Spacing="16">
        <TextBlock Text="Media"
                   FontSize="18"
                   FontWeight="SemiBold"/>

        <!-- Upload Buttons -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0"
                    Content="Upload Image"
                    Click="UploadImage_Click"
                    HorizontalAlignment="Stretch"
                    Margin="0,0,8,0">
                <Button.Content>
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xEB9F;" FontSize="16"/>
                        <TextBlock Text="Upload Image"/>
                    </StackPanel>
                </Button.Content>
            </Button>

            <Button Grid.Column="1"
                    Content="Upload Video"
                    Click="UploadVideo_Click"
                    HorizontalAlignment="Stretch"
                    Margin="8,0,0,0">
                <Button.Content>
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE714;" FontSize="16"/>
                        <TextBlock Text="Upload Video"/>
                    </StackPanel>
                </Button.Content>
            </Button>
        </Grid>

        <!-- Upload Progress -->
        <StackPanel x:Name="UploadProgressPanel"
                    Visibility="Collapsed"
                    Spacing="8">
            <ProgressBar x:Name="UploadProgressBar"
                         IsIndeterminate="True"/>
            <TextBlock x:Name="UploadProgressText"
                       FontSize="14"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       HorizontalAlignment="Center"/>
        </StackPanel>

        <!-- Media List -->
        <ItemsControl x:Name="MediaItemsControl">
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Border Style="{StaticResource MediaCardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Media Preview -->
                            <Grid Grid.Row="0"
                                  Height="120"
                                  CornerRadius="4"
                                  Margin="0,0,0,8">
                                <!-- Image Preview -->
                                <Image Source="{Binding Url}"
                                       Stretch="UniformToFill"
                                       Visibility="{Binding Type, Converter={StaticResource MediaTypeToVisibilityConverter}, ConverterParameter=Image}"/>

                                <!-- Video Preview -->
                                <Grid Visibility="{Binding Type, Converter={StaticResource MediaTypeToVisibilityConverter}, ConverterParameter=Video}">
                                    <Border Background="{ThemeResource LayerFillColorDefaultBrush}">
                                        <FontIcon Glyph="&#xE714;"
                                                  FontSize="48"
                                                  Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                  HorizontalAlignment="Center"
                                                  VerticalAlignment="Center"/>
                                    </Border>
                                </Grid>
                            </Grid>

                            <!-- Media Info & Actions -->
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="{Binding Title}"
                                               FontWeight="SemiBold"
                                               TextTrimming="CharacterEllipsis"/>
                                    <TextBlock Text="{Binding Type}"
                                               FontSize="12"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1"
                                            Orientation="Horizontal"
                                            Spacing="8">
                                    <Button Content="&#xE70F;"
                                            FontFamily="Segoe MDL2 Assets"
                                            FontSize="14"
                                            ToolTipService.ToolTip="Move Up"
                                            Tag="{Binding}"
                                            Click="MoveMediaUp_Click"
                                            Style="{StaticResource IconButtonStyle}"/>
                                    <Button Content="&#xE74B;"
                                            FontFamily="Segoe MDL2 Assets"
                                            FontSize="14"
                                            ToolTipService.ToolTip="Move Down"
                                            Tag="{Binding}"
                                            Click="MoveMediaDown_Click"
                                            Style="{StaticResource IconButtonStyle}"/>
                                    <Button Content="&#xE74D;"
                                            FontFamily="Segoe MDL2 Assets"
                                            FontSize="14"
                                            ToolTipService.ToolTip="Delete"
                                            Tag="{Binding}"
                                            Click="DeleteMedia_Click"
                                            Style="{StaticResource IconButtonStyle}"/>
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- Empty State -->
        <StackPanel x:Name="EmptyStatePanel"
                    HorizontalAlignment="Center"
                    Padding="24"
                    Visibility="Visible">
            <FontIcon Glyph="&#xEB9F;"
                      FontSize="48"
                      Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
            <TextBlock Text="No media added yet"
                       FontSize="14"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       Margin="0,8,0,0"
                       HorizontalAlignment="Center"/>
            <TextBlock Text="Upload images or videos to enhance your guide"
                       FontSize="12"
                       Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                       Margin="0,4,0,0"
                       HorizontalAlignment="Center"/>
        </StackPanel>
    </StackPanel>
</UserControl>
